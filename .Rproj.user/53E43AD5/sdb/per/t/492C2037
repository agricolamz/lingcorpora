{
    "collab_server" : "",
    "contents" : "#' Avar search\n#'\n#' Post query to the Avar Text Corpus (http://baltoslav.eu/avar/index.php). Don't forget to check main page for advanced query language.\n#' @param query Vector of length 1 which contain query.\n#' @param kwic Logical. KWIC (key word in context) is the format for resulted lines. If TRUE, then it returns a dataframe with query in the middle and left and right contexts. If FALSE, then it returns each result in one string. By default is TRUE.\n#' @param write This argument writes a file in the working derictory (see function getwd() and setwd() for more information). If FALSE, then it creates a dataframe in Global Environment. Otherwise function writes a .tsv file with the name frome the argument value. By default is FALSE.\n#' @author George Moroz <agricolamz@gmail.com>\n#' @examples\n#' ava_corpus(\"магIарул\")\n#' ava_corpus(\"магIарул*\")\n#' ava_corpus(\"ва(ц|с)азе\", kwic = F)\n#' @export\n#' @import xml2\n#' @import selectr\n#' @import httr\n#' @import rvest\n#' @import stringr\n\nava_corpus <- function(query, kwic = TRUE, write = FALSE){\n  if(length(query) != 1){\n    warning('x must be of length 1. If you want a dataframe with different queries try \\n do.call(\"rbind.data.frame\", sapply(x, ava.corpus, simplify = F))')\n  }\n\n  # get url\n  my.url <- paste0(\"http://baltoslav.eu/avar/index.php?xxx=\",\n                  query,\n                  \"&met=kon&ks=ca&f=d&mova=en#wierch\")\n\n  # get text\n  xml2::read_html(my.url) %>%\n    html_nodes(\"td:nth-child(1) > div:nth-child(2) > div:nth-child(6) > div:nth-child(2) > div:nth-child(1)\") %>%\n    html_text() ->\n    lines\n\n  # get query result\n  xml2::read_html(my.url) %>%\n    html_nodes(\"td:nth-child(1) > div:nth-child(2) > div:nth-child(6) > div:nth-child(2) > div:nth-child(1) > b:nth-child(2)\") %>%\n    html_text() ->\n    query_word\n\n  # get final dataframe\n  text_parts <- unlist(stringr::str_split(lines, paste0(\" \", query_word, \" \")))\n  results <- data.frame(left.part = text_parts[1:20*2-1],\n                        center.part = query_word,\n                        right.part = text_parts[1:20*2])\n\n  # kwic argument\n  if(kwic == F){\n    results <- apply(results, 1, function(x) paste(x, collapse = \"\"))\n  }\n\n  # write argument\n  if(write != FALSE){\n    write.table(results, paste0(write, \".csv\"), row.names = F, sep = \"\\t\")\n  } else {return(results)}\n  }\n",
    "created" : 1482145928400.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2471245753",
    "id" : "492C2037",
    "lastKnownWriteTime" : 1482175164,
    "last_content_update" : 1482175164567,
    "path" : "~/_DATA/OneDrive1/_Work/github/lingcorpora/lingcorpora.R/R/ava_corpus.R",
    "project_path" : "R/ava_corpus.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}